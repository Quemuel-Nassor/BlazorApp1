@using Blazorise.DataGrid
@using BlazorApp1.Extensions
@inherits DataGridBase
@page "/gridsample"

<PageTitle>Grid Sample</PageTitle>

<h1>Grid Sample</h1>

<p>This component demonstrates fetching data from the server.</p>

<Button Clicked="Request">Get Items</Button>

<DataGrid TItem="Sample"
          @ref="dataGridRef"
          Data="@Items"
          PageSize="3"
          CurrentPage="@GridCurrentPage"
          ReadData="@OnReadData"
          TotalItems="@ItemsSrc.Count"
          ShowPager
          Responsive>

    <DataGridColumns>
        <DataGridCommandColumn />
        <DataGridColumn Field="@nameof(Sample.Id)" Caption="Id"></DataGridColumn>
        <DataGridColumn Field="@nameof(Sample.Name)" Caption="Name"></DataGridColumn>
        <DataGridColumn Field="@nameof(Sample.Date)" Caption="Date"></DataGridColumn>
        <DataGridColumn Field="@nameof(Sample.Action)" Caption="Action"></DataGridColumn>
    </DataGridColumns>
    <LoadingTemplate>
        <div class="spinner-border" role="status">
            Loading 
            <span class="sr-only">Loading...</span>
        </div>
    </LoadingTemplate>
</DataGrid>

@code {
    int Page;
    string Sorting;
    int skipCount;
    DataGrid<Sample> dataGridRef;

    @* protected override void OnParametersSet()
    {
        Console.WriteLine($"sorting: event=({Sorting}) - ({GridSorting})");
        Console.WriteLine($"page: event=({Page}) - ({GridCurrentPage})");

        Page = GridCurrentPage;
        Sorting = GridSorting;


    } *@

    protected override void OnInitialized()
    {
        OnReadDataAction += async () => await Request();
        Page = GridCurrentPage;
        Sorting = GridSorting;
        @* InitGrid = false; *@
        @* Request(); *@
        @* InitGrid = true; *@
    }

    private List<Sample> Items { get; set; } = new();
    private List<Sample> ItemsSrc { get; set; } = new(){
            new Sample(){
                Id = 1,
                Name = "João",
                Date = DateTime.Now
            },new Sample(){
                Id = 2,
                Name = "Maria",
                Date = DateTime.Now.AddHours(1)
            },new Sample(){
                Id = 3,
                Name = "Antonio",
                Date = DateTime.Now.AddHours(2)
            },new Sample(){
                Id = 4,
                Name = "Zezinho",
                Date = DateTime.Now.AddHours(3)
            },new Sample(){
                Id = 5,
                Name = "Julieta",
                Date = DateTime.Now.AddHours(4)
            },new Sample(){
                Id = 6,
                Name = "Ofelia",
                Date = DateTime.Now.AddHours(5)
            },
        };

    public async Task Request()
    {

        @* Console.WriteLine($"sorting: event=({Sorting}) - ({GridSorting})"); *@
        Console.WriteLine($"page: event=({Page}) - ({GridCurrentPage})");

        Page = GridCurrentPage;
        @* Sorting = GridSorting; *@


        @* await dataGridRef.Reload(); *@
        await dataGridRef.Refresh();
        Console.WriteLine($"Requisitou dados na API - {Items.Count}");
        await Task.Delay(500);
        Items = ItemsSrc.Skip((Page-1) * 3).Take(3).ToList();
        @* skipCount = skipCount < ItemsSrc.Count ? skipCount + 3 : 0; *@
        Console.WriteLine($"Concluiu requisição - {Items.Count}");
    }

    public class Sample
    {
        public int Id { get; set; }
        public string Name { get; set; }
        public DateTime Date { get; set; }
        public int Action { get; set; }
    }
}